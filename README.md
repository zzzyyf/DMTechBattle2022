# DMTechBattle2022
## 编译与要求
内含 [asio（独立版）1.24.0](http://think-async.com/Asio/)

编译：
```bash
make build

# generate compile_commands.json for clangd
make clean
bear -- make
```

## 题目要求
1. 客户端程序持续发送从文本文件中读取的一行数据，每行有 16-1000 个随机 8 字节整数（行内用 `,` 分隔，行间用 `\r\n` 分隔）服务端完成求和运算后把结果返回给客户端，客户端将结果按序写入到另一文本文件
2. 完成 1 亿次上述操作，统计时间
3. 使用语言：C，C++，Java，Rust
4. 环境：x86 Linux
5. 场景：
    1. 本地进程间通信
    2. 万兆网
    3. RDMA

## 思路
1. 本地进程间通信可以使用 unix domain socket
2. 服务端计算和发送结果耗时相对小，瓶颈估计在客户端的请求产生和发送
    - 输入数据随机，压缩收益不大
3. 并行处理较容易
    1. 客户端解析数据可以直接按文件大小均分起始位置，从第一个完整行开始
    2. 每个客户端线程对应一个客户端连接，对应一个服务端连接和服务端线程
    3. 客户端线程解析、攒批后发送
        - 客户端的解析可能需要等待发送完成，或者直接采用同步发送
        - 客户端接收响应可以直接用回调处理
    4. 服务端接收后就解析、计算、攒批后发送结果
        - 服务端的“接收、解析、计算”和“发送”之间也需要同步
    5. 客户端各线程各自用一个文件持久化结果，最后再依次合并
4. 数据量相对较大，应分批处理

## 模块
### 客户端
- 数据解析、攒批发送、接收并存储结果
- epoll 网络通信（普通 tcp socket 和 unix domain socket）
- 线程管理

### 服务端
- 请求解析、计算、攒批返回结果
- epoll 网络通信（普通 tcp socket 和 unix domain socket）
- 线程管理
